openapi: 3.0.0
info:
  title: Athenai API
  description: |
    API documentation for the Athenai multi-tenant gym management platform.
  version: 2.0.0

servers:
  - url: http://localhost:8080/api/v1
    description: Development server

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token for authenticated requests. Contains user context including:
        - User ID, type (platform_admin/tenant_user), and role
        - Gym ID (for tenant users) - extracted from token, not headers
        - All authorization decisions based on JWT claims
    GymIdHeader:
      type: apiKey
      in: header
      name: X-Gym-ID
      description: |
        **ONLY REQUIRED FOR LOGIN ENDPOINT**
        - Used to determine authentication type (platform admin vs tenant user)
        - All other endpoints use gym context from JWT token
        - NOT used for authorization after login

  responses:
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/APIErrorResponse"
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/APIErrorResponse"
    Forbidden:
      description: Insufficient permissions
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/APIErrorResponse"
    BadRequest:
      description: Invalid request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/APIErrorResponse"
    Conflict:
      description: Resource conflict
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/APIErrorResponse"
    Created:
      description: Resource created successfully
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/APIResponse"
    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/APIErrorResponse"
    SuccessResponse:
      description: Operation completed successfully
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/APIResponse"

  schemas:
    LoginRequestDTO:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          example: "admin"
          description: "Username for authentication"
        password:
          type: string
          format: password
          example: "securePassword123"
          description: "User password"

    LoginResponseDTO:
      type: object
      properties:
        access_token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
          description: "JWT access token (expires in 24 hours)"
        refresh_token:
          type: string
          example: "d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6"
          description: "Refresh token (expires in 30 days)"
        user_info:
          $ref: "#/components/schemas/UserInfoDTO"

    UserInfoDTO:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
          description: "User unique identifier"
        username:
          type: string
          example: "johndoe"
          description: "Username"
        email:
          type: string
          format: email
          example: "john@olympusgym.com"
          description: "User email address"
        user_type:
          type: string
          enum: ["platform_admin", "tenant_user"]
          example: "tenant_user"
          description: "Type of user account"
        role:
          type: string
          enum: ["admin", "user", "guest"]
          example: "admin"
          description: "User role within gym (only for tenant users)"
          nullable: true
        gym_id:
          type: string
          format: uuid
          example: "456e7890-e89b-12d3-a456-426614174000"
          description: "Associated gym ID (only for tenant users)"
          nullable: true

    APIResponse:
      type: object
      properties:
        status:
          type: string
          enum: ["success"]
          example: "success"
          description: "Response status"
        message:
          type: string
          example: "Operation completed successfully"
          description: "Human-readable message"
        data:
          description: "Response data (varies by endpoint)"

    APIErrorResponse:
      type: object
      properties:
        status:
          type: string
          enum: ["error"]
          example: "error"
          description: "Response status"
        message:
          type: string
          example: "An error occurred"
          description: "Human-readable error message"
        data:
          type: object
          properties:
            code:
              type: string
              enum:
                - "BAD_REQUEST"
                - "UNAUTHORIZED"
                - "FORBIDDEN"
                - "NOT_FOUND"
                - "CONFLICT"
                - "INTERNAL_ERROR"
              example: "BAD_REQUEST"
              description: "Error code"
            error:
              type: string
              example: "Invalid input provided"
              description: "Technical error details"
              nullable: true

    TokenValidationResponseDTO:
      type: object
      properties:
        valid:
          type: boolean
          example: true
          description: "Whether the token is valid"
        claims:
          $ref: "#/components/schemas/ClaimsDTO"
        message:
          type: string
          example: "Token validation result"
          description: "Validation result message"

    ClaimsDTO:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        username:
          type: string
          example: "johndoe"
        user_type:
          type: string
          enum: ["platform_admin", "tenant_user"]
          example: "tenant_user"
        gym_id:
          type: string
          format: uuid
          example: "456e7890-e89b-12d3-a456-426614174000"
          nullable: true
        role:
          type: string
          enum: ["admin", "user", "guest"]
          example: "admin"
          nullable: true
        is_active:
          type: boolean
          example: true
        exp:
          type: integer
          format: int64
          example: 1642248000
          description: "Token expiration timestamp"
        iat:
          type: integer
          format: int64
          example: 1642161600
          description: "Token issued at timestamp"

    # User related schemas
    UserCreationDTO:
      type: object
      required:
        - username
        - email
        - password
        - role
      properties:
        username:
          type: string
          example: "john_doe"
        email:
          type: string
          format: email
          example: "john@example.com"
        password:
          type: string
          format: password
          example: "securePassword123"
        role:
          type: string
          enum: [user, admin]
          example: "user"

    UserUpdateDTO:
      type: object
      properties:
        username:
          type: string
        email:
          type: string
          format: email
        role:
          type: string
          enum: [user, admin]

    UserResponseDTO:
      type: object
      properties:
        id:
          type: string
        username:
          type: string
        email:
          type: string
        role:
          type: string
        gymId:
          type: string
        verified:
          type: boolean
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    UserActiveDTO:
      type: object
      required:
        - active
      properties:
        active:
          type: boolean
          example: true

    # Gym related schemas
    GymCreationDTO:
      type: object
      required:
        - name
        - email
        - address
        - phone
      properties:
        name:
          type: string
          example: "Fitness First"
          description: "Gym name"
        email:
          type: string
          format: email
          example: "contact@fitnessfirst.com"
          description: "Gym contact email"
        address:
          type: string
          example: "123 Main St, City, State 12345"
          description: "Gym address"
        phone:
          type: string
          example: "+1-555-123-4567"
          description: "Gym contact phone"
        is_active:
          type: boolean
          example: true

    GymUpdateDTO:
      type: object
      properties:
        name:
          type: string
          example: "New Gym Name"
          description: "Updated gym name"

    GymResponseDTO:
      type: object
      properties:
        gym_id:
          type: string
          format: uuid
          example: "123e4567-e89b-12d3-a456-426614174000"
        name:
          type: string
          example: "Fitness First"
        domain:
          type: string
          example: "fitnessfirst"
        is_active:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    GymActivateDTO:
      type: object
      required:
        - active
      properties:
        active:
          type: boolean
          example: true

    RefreshTokenRequestDTO:
      type: object
      required:
        - refresh_token
      properties:
        refresh_token:
          type: string
          example: "d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6"
          description: "Valid refresh token"

    # Equipment related schemas
    EquipmentCreationDTO:
      type: object
      required:
        - name
        - description
        - category
      properties:
        name:
          type: string
          example: "Barbell"
        description:
          type: string
          example: "Standard Olympic barbell for weightlifting"
        category:
          type: string
          example: "free_weights"

    EquipmentUpdateDTO:
      type: object
      properties:
        name:
          type: string
          example: "Barbell"
        description:
          type: string
          example: "Standard Olympic barbell for weightlifting"
        category:
          type: string
          example: "free_weights"
        is_active:
          type: boolean
          example: true

    EquipmentResponseDTO:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        name:
          type: string
          example: "Barbell"
        description:
          type: string
          example: "Standard Olympic barbell for weightlifting"
        category:
          type: string
          example: "free_weights"
        is_active:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    # Muscular Group related schemas
    CreateMuscularGroupDTO:
      type: object
      required:
        - name
        - description
        - body_part
      properties:
        name:
          type: string
          example: "Biceps"
        description:
          type: string
          example: "Front upper arm muscles"
        body_part:
          type: string
          enum: ["upper_body", "lower_body", "core", "full_body"]
          example: "upper_body"

    UpdateMuscularGroupDTO:
      type: object
      properties:
        name:
          type: string
          example: "Biceps"
        description:
          type: string
          example: "Front upper arm muscles"
        body_part:
          type: string
          enum: ["upper_body", "lower_body", "core", "full_body"]
          example: "upper_body"
        is_active:
          type: boolean
          example: true

    MuscularGroupResponseDTO:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        name:
          type: string
          example: "Biceps"
        description:
          type: string
          example: "Front upper arm muscles"
        body_part:
          type: string
          example: "upper_body"
        is_active:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    # Exercise related schemas
    ExerciseCreationDTO:
      type: object
      required:
        - name
        - muscular_groups
        - difficulty_level
        - exercise_type
        - instructions
        - created_by
      properties:
        name:
          type: string
          example: "Push-ups"
        synonyms:
          type: array
          items:
            type: string
          example: ["press-ups", "floor press"]
        muscular_groups:
          type: array
          items:
            type: string
          example: ["chest", "triceps", "shoulders"]
        equipment_needed:
          type: array
          items:
            type: string
          example: ["mat"]
        difficulty_level:
          type: string
          enum: ["beginner", "intermediate", "advanced"]
          example: "beginner"
        exercise_type:
          type: string
          enum: ["strength", "cardio", "flexibility", "balance", "functional"]
          example: "strength"
        muscular_group_ids:
          type: array
          items:
            type: string
            format: uuid
          example: ["550e8400-e29b-41d4-a716-446655440000"]
        equipment_ids:
          type: array
          items:
            type: string
            format: uuid
          example: ["550e8400-e29b-41d4-a716-446655440001"]
        instructions:
          type: string
          example: "Start in plank position, lower body to floor, push back up"
        video_url:
          type: string
          format: uri
          example: "https://example.com/pushups-video.mp4"
        image_url:
          type: string
          format: uri
          example: "https://example.com/pushups-image.jpg"
        created_by:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440002"

    ExerciseUpdateDTO:
      type: object
      properties:
        name:
          type: string
          example: "Push-ups"
        synonyms:
          type: array
          items:
            type: string
          example: ["press-ups", "floor press"]
        muscular_groups:
          type: array
          items:
            type: string
          example: ["chest", "triceps", "shoulders"]
        equipment_needed:
          type: array
          items:
            type: string
          example: ["mat"]
        difficulty_level:
          type: string
          enum: ["beginner", "intermediate", "advanced"]
          example: "beginner"
        muscular_group_ids:
          type: array
          items:
            type: string
            format: uuid
          example: ["550e8400-e29b-41d4-a716-446655440000"]
        equipment_ids:
          type: array
          items:
            type: string
            format: uuid
          example: ["550e8400-e29b-41d4-a716-446655440001"]
        exercise_type:
          type: string
          enum: ["strength", "cardio", "flexibility", "balance", "functional"]
          example: "strength"
        instructions:
          type: string
          example: "Start in plank position, lower body to floor, push back up"
        video_url:
          type: string
          format: uri
          example: "https://example.com/pushups-video.mp4"
        image_url:
          type: string
          format: uri
          example: "https://example.com/pushups-image.jpg"
        is_active:
          type: boolean
          example: true

    ExerciseResponseDTO:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        name:
          type: string
          example: "Push-ups"
        synonyms:
          type: array
          items:
            type: string
          example: ["press-ups", "floor press"]
        muscular_groups:
          type: array
          items:
            type: string
          example: ["chest", "triceps", "shoulders"]
        equipment_needed:
          type: array
          items:
            type: string
          example: ["mat"]
        difficulty_level:
          type: string
          enum: ["beginner", "intermediate", "advanced"]
          example: "beginner"
        exercise_type:
          type: string
          enum: ["strength", "cardio", "flexibility", "balance", "functional"]
          example: "strength"
        instructions:
          type: string
          example: "Start in plank position, lower body to floor, push back up"
        muscular_group_ids:
          type: array
          items:
            type: string
            format: uuid
          example: ["550e8400-e29b-41d4-a716-446655440000"]
        equipment_ids:
          type: array
          items:
            type: string
            format: uuid
          example: ["550e8400-e29b-41d4-a716-446655440001"]
        video_url:
          type: string
          format: uri
          example: "https://example.com/pushups-video.mp4"
        image_url:
          type: string
          format: uri
          example: "https://example.com/pushups-image.jpg"
        created_by:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440002"
        is_active:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    # Workout Template related schemas
    CreateWorkoutTemplateDTO:
      type: object
      required:
        - name
        - difficulty_level
        - created_by
      properties:
        name:
          type: string
          example: "Full Body Beginner Workout"
        description:
          type: string
          example: "A complete full-body workout suitable for beginners"
        difficulty_level:
          type: string
          enum: ["beginner", "intermediate", "advanced"]
          example: "beginner"
        estimated_duration_minutes:
          type: integer
          example: 45
        target_audience:
          type: string
          example: "beginners"
        created_by:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440002"

    UpdateWorkoutTemplateDTO:
      type: object
      required:
        - name
        - difficulty_level
      properties:
        name:
          type: string
          example: "Full Body Beginner Workout"
        description:
          type: string
          example: "A complete full-body workout suitable for beginners"
        difficulty_level:
          type: string
          enum: ["beginner", "intermediate", "advanced"]
          example: "beginner"
        estimated_duration_minutes:
          type: integer
          example: 45
        target_audience:
          type: string
          example: "beginners"
        is_active:
          type: boolean
          example: true
        is_public:
          type: boolean
          example: true

    WorkoutTemplateDTO:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        name:
          type: string
          example: "Full Body Beginner Workout"
        description:
          type: string
          example: "A complete full-body workout suitable for beginners"
        difficulty_level:
          type: string
          enum: ["beginner", "intermediate", "advanced"]
          example: "beginner"
        estimated_duration_minutes:
          type: integer
          example: 45
        target_audience:
          type: string
          example: "beginners"
        created_by:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440002"
        is_active:
          type: boolean
          example: true
        is_public:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    # Exercise Equipment Join related schemas
    ExerciseEquipmentDTO:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        exercise_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"
        equipment_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440002"

    ExerciseEquipmentLinkDTO:
      type: object
      required:
        - exercise_id
        - equipment_id
      properties:
        exercise_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"
        equipment_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440002"

    # Exercise Muscular Group Join related schemas
    ExerciseMuscularGroupDTO:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        exercise_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"
        muscular_group_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440002"

    ExerciseMuscularGroupLinkDTO:
      type: object
      required:
        - exercise_id
        - muscular_group_id
      properties:
        exercise_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"
        muscular_group_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440002"

    # Template Block related schemas
    CreateTemplateBlockDTO:
      type: object
      required:
        - template_id
        - name
        - type
        - order
        - exercise_count
      properties:
        template_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"
        name:
          type: string
          example: "Warm-up Block"
        type:
          type: string
          example: "warmup"
        order:
          type: integer
          example: 1
        exercise_count:
          type: integer
          example: 3
        estimated_duration_minutes:
          type: integer
          example: 10
        instructions:
          type: string
          example: "Start with light movements to prepare your body"

    UpdateTemplateBlockDTO:
      type: object
      properties:
        template_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"
        name:
          type: string
          example: "Warm-up Block"
        type:
          type: string
          example: "warmup"
        order:
          type: integer
          example: 1
        exercise_count:
          type: integer
          example: 3
        estimated_duration_minutes:
          type: integer
          example: 10
        instructions:
          type: string
          example: "Start with light movements to prepare your body"

    TemplateBlockDTO:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        template_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"
        name:
          type: string
          example: "Warm-up Block"
        type:
          type: string
          example: "warmup"
        order:
          type: integer
          example: 1
        exercise_count:
          type: integer
          example: 3
        estimated_duration_minutes:
          type: integer
          example: 10
        instructions:
          type: string
          example: "Start with light movements to prepare your body"
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

paths:
  # Auth routes
  /auth/login:
    $ref: "./paths/auth/login.yaml"

  /auth/refresh:
    $ref: "./paths/auth/refresh.yaml"

  /auth/logout:
    $ref: "./paths/auth/logout.yaml"

  /auth/validate:
    $ref: "./paths/auth/validate.yaml"

  # User routes
  /user:
    $ref: "./paths/user/user.yaml"

  /user/{id}:
    $ref: "./paths/user/user-by-id.yaml"

  /user/username/{username}:
    $ref: "./paths/user/user-by-username.yaml"

  /user/email/{email}:
    $ref: "./paths/user/user-by-email.yaml"

  /user/{id}/verify:
    $ref: "./paths/user/user-verify.yaml"

  /user/{id}/active:
    $ref: "./paths/user/user-active.yaml"

  # Gym routes
  /gym:
    $ref: "./paths/gym/gym.yaml"

  /gym/{id}:
    $ref: "./paths/gym/gym-by-id.yaml"

  /gym/{id}/update:
    $ref: "./paths/gym/gym-update.yaml"

  /gym/{id}/activate:
    $ref: "./paths/gym/gym-activate.yaml"

  /gym/{id}/deactivate:
    $ref: "./paths/gym/gym-deactivate.yaml"

  # Template Block routes
  /template-blocks:
    $ref: "./paths/template_block/template_block.yaml"

  /template-blocks/{id}:
    $ref: "./paths/template_block/template_block-by-id.yaml"

  # Equipment routes
  /equipment:
    $ref: "./paths/equipment/equipment.yaml"

  /equipment/{id}:
    $ref: "./paths/equipment/equipment-id.yaml"

  # Muscular Groups routes
  /muscular-groups:
    $ref: "./paths/muscular-groups/muscular-groups.yaml"

  /muscular-groups/{id}:
    $ref: "./paths/muscular-groups/muscular-groups-id.yaml"

  # Exercise routes
  /exercises:
    $ref: "./paths/exercises/exercises.yaml"

  /exercises/search:
    $ref: "./paths/exercises/exercises-search.yaml"

  /exercises/{id}:
    $ref: "./paths/exercises/exercises-id.yaml"

  # Workout Template routes
  /workout-templates:
    $ref: "./paths/workout-templates/workout-templates.yaml"

  /workout-templates/{id}:
    $ref: "./paths/workout-templates/workout-templates-id.yaml"

  /workout-templates/name/{name}:
    $ref: "./paths/workout-templates/workout-templates-name.yaml"

  /workout-templates/difficulty/{difficulty}:
    $ref: "./paths/workout-templates/workout-templates-difficulty.yaml"

  /workout-templates/target-audience/{targetAudience}:
    $ref: "./paths/workout-templates/workout-templates-target-audience.yaml"

  # Exercise Equipment Link routes
  /exercise-equipment/link:
    $ref: "./paths/exercise-equipment/exercise-equipment-link.yaml"

  /exercise-equipment/link/{id}:
    $ref: "./paths/exercise-equipment/exercise-equipment-link-id.yaml"

  /exercise-equipment/exercise/{exerciseID}/links:
    $ref: "./paths/exercise-equipment/exercise-equipment-links-by-exercise.yaml"

  /exercise-equipment/equipment/{equipmentID}/links:
    $ref: "./paths/exercise-equipment/exercise-equipment-links-by-equipment.yaml"

  # Exercise Muscular Group Link routes
  /exercise-muscular-groups/link:
    $ref: "./paths/exercise-muscular-groups/exercise-muscular-groups-link.yaml"

  /exercise-muscular-groups/link/{id}:
    $ref: "./paths/exercise-muscular-groups/exercise-muscular-groups-link-id.yaml"

  /exercise-muscular-groups/exercise/{exerciseID}/links:
    $ref: "./paths/exercise-muscular-groups/exercise-muscular-groups-links-by-exercise.yaml"

  /exercise-muscular-groups/muscular-group/{muscularGroupID}/links:
    $ref: "./paths/exercise-muscular-groups/exercise-muscular-groups-links-by-muscular-group.yaml"
